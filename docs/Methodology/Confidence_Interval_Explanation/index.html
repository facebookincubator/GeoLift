<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.14">
<link rel="alternate" type="application/rss+xml" href="/GeoLift/blog/rss.xml" title="GeoLift RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/GeoLift/blog/atom.xml" title="GeoLift Atom Feed"><title data-react-helmet="true">Understanding p-value and the confidence intervals in GeoLift | GeoLift</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://facebookincubator.github.io//GeoLift/docs/Methodology/Confidence_Interval_Explanation"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Understanding p-value and the confidence intervals in GeoLift | GeoLift"><meta data-react-helmet="true" name="description" content="If you reached this section, it likely means that you were able to"><meta data-react-helmet="true" property="og:description" content="If you reached this section, it likely means that you were able to"><link data-react-helmet="true" rel="canonical" href="https://facebookincubator.github.io//GeoLift/docs/Methodology/Confidence_Interval_Explanation"><link data-react-helmet="true" rel="alternate" href="https://facebookincubator.github.io//GeoLift/docs/Methodology/Confidence_Interval_Explanation" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://facebookincubator.github.io//GeoLift/docs/Methodology/Confidence_Interval_Explanation" hreflang="x-default"><link rel="stylesheet" href="/GeoLift/assets/css/styles.e9295fda.css">
<link rel="preload" href="/GeoLift/assets/js/runtime~main.2c495a46.js" as="script">
<link rel="preload" href="/GeoLift/assets/js/main.66c3a460.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/GeoLift/"><b class="navbar__title">GeoLift</b></a><a class="navbar__item navbar__link navbar__link--active" href="/GeoLift/docs/intro">Documentation</a><a class="navbar__item navbar__link" href="/GeoLift/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/facebookincubator/GeoLift/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="toggle_71bT toggle_3Zt9 toggleDisabled_3cF-"><div class="toggleTrack_32Fl" role="button" tabindex="-1"><div class="toggleTrackCheck_3lV7"><span class="toggleIcon_O4iE">🌜</span></div><div class="toggleTrackX_S2yS"><span class="toggleIcon_O4iE">🌞</span></div><div class="toggleTrackThumb_xI_Z"></div></div><input type="checkbox" class="toggleScreenReader_28Tw" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_31aa"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_35hR" type="button"></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/GeoLift/docs/intro">Welcome to GeoLift</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_2fq0" href="/GeoLift/docs/GettingStarted/InstallingR">Getting Started</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--active hasHref_2fq0" href="/GeoLift/docs/Methodology/">Methodology</a><button aria-label="Toggle the collapsible sidebar category &#x27;Methodology&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/GeoLift/docs/Methodology/ComparisonOthers">Comparison to other Methodologies</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/GeoLift/docs/Methodology/Confidence_Interval_Explanation">Understanding p-value and the confidence intervals in GeoLift</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_2fq0" href="/GeoLift/docs/Best Practices/BestPractices">Best Practices</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/GeoLift/docs/About">About GeoLift</a></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD theme-doc-toc-mobile tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Understanding p-value and the confidence intervals in GeoLift</h1></header><p>If you reached this section, it likely means that you were able to
successfully run the previous steps in the guide and are now keen to
deep-dive in understanding the details of the GeoLift package. In this
part, we are going to explain the two methods employed by GeoLift to
estimate the confidence interval and p-values of the Average Treatment
Effect on the Treated (ATT). We will use the example from the
Walkthrough to demonstrate and give some intuition how the method works.</p><p>From the Walkthrough example, we conducted a localized experiment in two
locations (Chicago and Portland) for a period of 15 days. By using the
GeoLift package, we were able to easily estimate the ATT of our
marketing efforts on the two regions:</p><div class="codeBlockContainer_K1bP language-r theme-code-block"><div class="codeBlockContent_hGly r"><pre tabindex="0" class="prism-code language-r codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">library(GeoLift)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">library(ggplot2)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">data(GeoLift_Test)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">treated_locations = c(&quot;chicago&quot;, &quot;portland&quot;)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">post_period_start &lt;- 91</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">post_period_ends &lt;- 105</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">GeoTestData_Test &lt;- GeoDataRead(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  data = GeoLift_Test,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  date_id = &quot;date&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  location_id = &quot;location&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Y_id = &quot;Y&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  X = c(), # empty list as we have no covariates</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  format = &quot;yyyy-mm-dd&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  summary = TRUE</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#&gt; ##################################</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#&gt; #####       Summary       #####</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#&gt; ##################################</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#&gt; </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#&gt; * Raw Number of Locations: 40</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#&gt; * Time Periods: 105</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#&gt; * Final Number of Locations (Complete): 40</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">GeoTest &lt;- GeoLift(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Y_id = &quot;Y&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  data = GeoTestData_Test,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  locations = c(&quot;chicago&quot;, &quot;portland&quot;),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  treatment_start_time = post_period_start,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  treatment_end_time = post_period_ends,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ConfidenceIntervals = TRUE</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#&gt; Conformal method of Confidence Interval calculation unsuccessful. Changing Confidence Interval calculation method to jackknife+.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">GeoTest</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#&gt; </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#&gt; GeoLift Output</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#&gt; </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#&gt; Test results for 15 treatment periods, from time-stamp 91 to 105 for test markets:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#&gt; 1 CHICAGO</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#&gt; 2 PORTLAND</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#&gt; ##################################</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#&gt; #####     Test Statistics    #####</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#&gt; ##################################</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#&gt; </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#&gt; Percent Lift: 5.4%</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#&gt; </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#&gt; Incremental Y: 4667</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#&gt; </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#&gt; 90% Confidence Interval: (-2450.734, 11349.93)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#&gt; </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#&gt; Average Estimated Treatment Effect (ATT): 155.556</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#&gt; </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#&gt; The results are significant at a 95% level. (TWO-SIDED LIFT TEST)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#&gt; </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#&gt; There is a 1.2% chance of observing an effect this large or larger assuming treatment effect is zero.</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>We can also visualize the ATT per day using the plot function</p><div class="codeBlockContainer_K1bP language-r theme-code-block"><div class="codeBlockContent_hGly r"><pre tabindex="0" class="prism-code language-r codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">plot(GeoTest, type = &quot;ATT&quot;)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#&gt; You can include dates in your chart if you supply the end date of the treatment. Just specify the treatment_end_date parameter.</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p><img alt="PlotLiftBest" src="/GeoLift/assets/images/GeoLiftBest-2-86798de1feb9f6536e5cf8ae73e7d4e0.png"></p><p>But how did GeoLift estimate these confidence intervals and p-values?</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="default-conformal-inference-method">Default: Conformal Inference Method<a class="hash-link" href="#default-conformal-inference-method" title="Direct link to heading">​</a></h2><p>As the default, GeoLift - or more accurately the Augmented Synthetic
Control package - uses a method called Conformal Inference to estimate
the confidence interval for the ATT. This <a href="https://arxiv.org/pdf/1712.09089.pdf" target="_blank" rel="noopener noreferrer">method developed in 2022 by
researchers Victor Chernozhukov, Kaspar Wütrich, and Yinchu
Zhu</a> has been shown to work with
multiples approaches for estimating counterfactual outcomes, such as
Synthetic Control (the case here), Difference-in-Differences, factor and
matrix completion models, among others. It demonstrates high
small-sample performance or when there are (reasonable)
misspecifications of the model.</p><h3 class="anchor anchorWithStickyNavbar_31ik" id="estimating-the-p-value">Estimating the p-value<a class="hash-link" href="#estimating-the-p-value" title="Direct link to heading">​</a></h3><p>From the paper, the p-value (i.e. the probability of observing a data as
or more absurd, assuming that the null-hypothesis is true) for a chosen
date is given by</p><p><img alt="Equation 1" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAaEAAABIBAMAAACtulcPAAAAMFBMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAv3aB7AAAAD3RSTlMAuyLN7xCrmd12iVREMmZJimJiAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAKBUlEQVRoBe0bW4hrV3XncZLJax6We1EUTsD7cUEkU3SsYjFTtXB9YAYs9oJCRryf0lwoFD+EDPQWrIgZUPwSMqB/gpmPgn4UEhHBL2dAwQ/RTKG/GqcTe6PWbtc+a6+91klOXodmcik9H3PWXnvt9dh7r8feOaPUmp73rUnuysSmhuWV8V4PY19/dj2CVyU1cfW14cGqmK+Fb2NbNV9ai+QVCc28qVRu9G5apMYJTFV3d0XztQa22X8bocWrNYhekcjEacD4j++mbbeiqXqP7XszsNwMJJ+cTf/hXkT/C4zLHjL8aEBnszUqQgqbfJ7Zczjvc49YoJkXy88is1fyDptxa6IISZSdvWsA+iF9vNceDD8A+pTIjpKsMBLQYx9h6OScVK+lGv7t90LPi1Yzr1YmJeFd8vUnvlX7j1K3ti32mTdEt9B085LxAyK2qISOcWTJ/4sZLgb9/oGG5w6Y9aBmILtrUkEZQSwalz0wq/GSah1bVJUAaIc0FR1hHkr5e42nieOib6/5v0VJmS6rtZ3MbzS1tvj2LhOo26Nz0yqMMjoAoKyVFVNI0wprkCRqZJW5VFm5V4WAqaD3umZ+U6nGO3LaSfaqI+wNKVPSNxDbrZLBQm8V1jRnOZgR7SMch38bh4AJeafsjYK9v/k6jkUJtzBK1a0bJGRsvkULktHkJT5oR8+YprVj6lBpuXUz4IaqQKwczQwgr/XVII5FaaenUpmHKKErHb9Fu7+krYoFXXaajGvaZlfOkVca4mZgqYiFjsM0YPPmLw7ScSyqkJ7AOWdVbh2ymJw+pUbNbuoNsYTjmm7ZSTFj9H0aqdQHA7C0x5hFoFgWyYXd/G8gpqh7LK7OntH4J6LP3uLucU2zYmGavF48YCkolkUNbfUEUUVchMRQiG0bB8CnuY1vf98iIl4lfeywfelIDrsMEMuiGgVvkFTASa2wEUq1eEE6qGxSn8zQqnXkOjd4eR1uOSCORUktJnUTl6spkoAnfLNzHuiTdeE+Sr0OD87PJIwaPI6LY9EmpyOIDPsByxq+ArgkLGoGGJWWmxJR4u8Zh4aiDA2CZHEwjkUZkY5UdtcIK+lDllnQb7vGDkJ9EepcnwO2KA0DRrio618KiGNRWmPWy94HUYVTIy+nL8wLn5LtN62fIqrNNiIi9DchtpqPOzB576ke0Pxo+KmDEOn8RhyLKhrDwMaF458SCVR5eiIOVDn/Ptv6jBtmgbyYjw7afutDr8BWfOXlP/hfHqee045j0UBjLKuUHXO5b5SqiQyMJLyXipev2mRcuEPjC2LPdnF/fswsexZynSt1naw5QByLKB39nHn3Q0F3oPUXz7nTuNkRNfvHaoBJOe1WMqn3qVtVghhSfEMV9dG9soIFP3J9CwFxLKrpXcM7Kbx9IGClNuDUNHyuzAps8iJ8AS6X0Q3PeK9prhS2ggIisQ0WXQYHWB/tZ2ZzoBgWQTo6MVzvivTeQc+ywpLBSXD4XdtUKu+WI3+kVAdDW5N9T6TkjaCcqp+qgs0Rbbn8H/3r+FN2QiwQwyJIRz3YDX8WWUf56M/E/auwSPB8hdoJtxygqvLRohbnqCqvQyqocrtmFnCWBmw4ONXkMx4LY1jk2O6TwlD3sEoB8jco+cRSbLhi/MeAweDuad6pDV7uTFCPfNOc3HErdt1YSBLB4oesGr0DFqX1cGdn55PuZG60pkODtQAK2O8YubRyaZdwvg8ZDCdf5uEOFw35oGgAb9tCb1UDUXI59jOAGGtk01FOStKcb0jY1++BSXYCt2jnJCF/ZpA4K8Z06KRrNts2cICY0Le+13E+SJxnv2NYROmoes6shXaM/LWmIs1ZVDwykw9/TEDcN6/gabNFOarr20GIMF53TGQLvWNYROmowQI8EX4FtkpK12mxTGcXJ71OqgNqwJcJm3azgSW4wDUXVZjzLGjSokbI8aAxKocZ2HSkbBFqOpORFqkKLV1FWuTjFuyKuR9whN7EFYT4gTgoqXph+XNakxaNG6RFrDHMKB2pl5n1FIsSFOBDFllVmy5awBpNWlTSGC2KmnyQxc2EJi36yD/GnlfDDDAdQUICJ6fHo8UARJG3fY4sqgutbKhT7iYPxkTsupzGhJC1E0Ci5r4nLZo3hE5H3omgFBYlDh2+QJvRRQbosqHOEzdkKiIyZOzYDbtWjuk8YHmL6HQU4kyLAcg0r1GBSu4tscPS6ChFzVlVtTnZ5mwJaMlU3Rb6KG4lVRCdjqZZ1D91PS5uSYv6GNLzYhLURIZVEFXuB3wGFClMy5UrwtkPnDgEll8jSkchRqIKavdcT5YCL1dB4DOITNH6GeoGlnAGzNiEaskgiPMMragKonRkxLvH5y3kXzhsmoJ2QkTqJkaJoMj5pSX133ZjqKhtIJm3bGBQy68RpSOngwHEaULcy3dp6vk04SrvoMj5kmXS4ri5YV2uhpV5PuRGIZlTGktb5NJRiCGf+EqU86HfXXmJE5+qoqptSJwlOuhRTIQxeOKDrIcpqk6FVEjcrMbSFoUu6xznPsqHdo4Deda5gDiVKx9JTZGTO0IGk6dyBWICl286xk7WHGBpiygdhfnyzUmC88yAnUuEgUagY0nDUqWOkUtRlHhnWLSCmAvoLOilfhAz7LaW3aeR6UilXMLZ0tUTw9is1n0E4G+VHWUQnGDvajCsX0YCeTBp4zSk9UNjS39oSZBwkb9NPVpuDAyI4Ms3bv2HicuAoycOpqrDwawODqS8x0zh87zllMC4FrR8PGnV9Y2nFOy9G5ZksVdy57EWpKrh4zuniw1Q2Z0qDBg9fnOcvugue9pHqvnwd3Ch1Rz1mOqMi4Ig7d7eS2tVfMsSbIlJsgkVKvM/ffovvrupYFazoJL+PD4iW8yiN4k8GFCb/ObWhTW/rIpVPXp/bWidJOAob/LbV3//1ZuqVPv26ydWWp8P5SW7VaEy954fPTdbnZX2uh9MngQxyZ98fPhET8qTP6Ikf1Z74lypZ2s/JAo32BzKoQueFt4XEcUa3hVKptGyl/1FLFSZR7NcNTaFeXOqmOr+1C64Q75wnX0MIQXNkd/1XS9QMBFsxtOlKBBBkxWz0dwPCLKyMo8Ych0o+et/hDz56/94d1rs2NpJ0LshUvI4+XW1u5M3dlK0/EJD4g3cftphcjaKyosi13nNQIozTqTk6mEk2iBrF64rjW4EN2Ay9rvuawWSujxTXmXqGsqvutq7yKQ5xy1ninqnOjtWmSn88nzJOEZR4ZqPPgDzanPmZ4zFapopu2Gmca9eTOmp8gazXwy+BrXW1c3zKfTXhg5/1TkpNvRVp+jO8Z23am8HHT7UWvoR2HfhL2+FzgiGvrwVveJrs8kvbwXdGsB5+gjVhXazv44WhOsAzw5nSo3+gv3unhvkvXjg4EcDSP5gth63exH9LzCO/svg/wIeg9EkcvP5AAAAAElFTkSuQmCC"></p><p>where</p><p><img alt="Equation 2" src="data:image/png;base64,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"></p><p>and <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAARBAMAAAAmgTH3AAAAMFBMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAv3aB7AAAAD3RSTlMAIs0yRO9UZokQu6t2md3bjgcsAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAf0lEQVQIHWNgYGBgVAYSIOCqnwCm2cNYIsCMSQIMswzALHQiKXoCA0MPAwPbSvsLDMyfGBjmTchfwMDzg4GhgmF/AgPXF6AGzq8MDPwfgAz2vwwM/gpABki4vwHI4PvIwKDvYMXAwPSTgeU/w3Wgmj8MSfqCD4Byde8uzH4kAACARB3IVUvkFwAAAABJRU5ErkJggg=="> is the residual (i.e. the error) between what an
Augmented Synthetic Control Model (hereafter referred simply as ‘model’)
estimated and what was observed on the chose date for the treated
location (if there are more than 1 treated location, they are grouped
and averaged). The function <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADoAAAAZBAMAAACSrSCDAAAAMFBMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAv3aB7AAAAD3RSTlMAdrvd782ZImaJVDIQRKvcdQ0fAAAACXBIWXMAAA7EAAAOxAGVKw4bAAABl0lEQVQoFU1SPUsDQRScGPUul7szvYUB7RWENIqxET8K8RMLxViIARsFLcRGi/QJiJVIQv6A+QceipWFKexT2ApGMcZE4zlvLyH7YOfNzNuPt3sH6GFpQufKtpe1amgrEKHhmbSZI7+PKcPYVOlCoZUo2Zl8gXxbaTynRKAnLlgpA1HfA0K/ImEuOPOSjW+C/S50leMp2PjhEHcl8fIeV/wI22sr4Z044+yIbIBBjo+O3c7hacDx04Fy1DRr7ZUr1BmROgtvfu1a6hF1RPHxC7hdEsOSjqwR359gdmWqPWnxgKEcKaKcxzg9+CT2VQlmzm0Co2WxjT9BrkhShqXKe00DvmKowTkXliWqtaQ7cGriwf6AS58HlfhywVNx10hDPNm5NydkhcNVPSN5iL5WNE7DaeBsVgpjBLNFAFIeKtX+czKziezuFU6mPAojuEA2Zq3Xj6jhVrFvXPqLZRFYU2iOJ+yXDaEDcWW04Yat6SGfthvheJcLk1a7EeUraWHJy2qR8TSB44Ku+CNMatqe04SiRc3oYU//hihnkmEBXAQAAAAASUVORK5CYII="> defines the test statistics,
and it can be interpreted as an error functions, such as Mean Squared
Error and Mean Absolute Error:</p><p><img alt="Equation 3" src="data:image/png;base64,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"></p><p>where <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAVBAMAAACj2UNSAAAAMFBMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAv3aB7AAAAD3RSTlMAq80i73ZEMplUid0QZrt18JWPAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAArklEQVQYGWNgEFKCAEUGMGD+ElZc8X+6edYnCJ9rDwMDI4gtCOFzFzAwsPwCsldB+EVAyv4bkFgL4UcCqft/gEQ7hA8i5RUQbBDLfwEKn/l/Agqf9/8BFD7YeiQRsPUgfgJEEGw9kMkDcgYQgK1nYAhm+M6zBsSHWq/fsyfeGchl938AEmVgXu0kBqTef3Hx/wLmL3JCcjMDA0j9ZpAEFCyHmQcTgNkH4zNMYGAAAGmWLB0KXyRrAAAAAElFTkSuQmCC"> is the number of ‘dates’ in the Post-Treatment Period, <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAWBAMAAAAlTTH8AAAAMFBMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAv3aB7AAAAD3RSTlMAq80i73ZEMplUid0QZrt18JWPAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAyUlEQVQYGWNgEFKCAEUGMGD+ElZc8X+6edYnCJ9rDwMDI4gtCOFzFzAwsPwCsldB+EVAyv4bkFgL4UcCqft/gEQ7hA8i5RUQbBDLfwEKn/l/AojPqyh3ASzO+/8AiBY6wKMH5oOtZ+D9zMBwPgAkALaegduBAYyh1jOcV2Bg4AOqgVrPkP8A6PCfID7E+vkg/l8gl90fyGJggPHff3Hx/wLkI9SDZIF2KcDMA3MZuD/A7IPwWb8DbV4AYYPJ1wd4lJC4QP8IBTAAABiJNY6T/KnRAAAAAElFTkSuQmCC">
is the number of dates date in the Pre-Treatment Period, and <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARBAMAAAAvapGNAAAAMFBMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAv3aB7AAAAD3RSTlMAq80i73ZEMplUid0QZrt18JWPAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAdUlEQVQIHWNgEFKCAEUG5i9hxRX/p5tnfWLg2sPAwPiJgYFBkIG7gIGB5ReQuYqhCEjafwMSaxkigeT9P0CiHYgZGOQVwBSI8F8AYzL/T4Axef8fgDHBxkI4YGMhTLCxECbYWAgTYSy7/wOIEMP7Ly7+X0BsACFfHbu+mlLhAAAAAElFTkSuQmCC"> indicates the
last date available for the analysis (so <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAKcAAAAWBAMAAABXrpEPAAAAMFBMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAv3aB7AAAAD3RSTlMAq80i73ZEMplUid0QZrt18JWPAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAB0klEQVQ4EZVUTUsCURS9MpWlk2SLtk5CuyBXuTTM1i6CoJVCkNBKMqJ/0CaoXdtoE2TRoqCNkPgLxD+gfyCEsE+i6b6PefN8782oF+bNveece3HOe0+AxTSLZQiLCFelF0wqlbUGO7UT9zJ78GZSCyy3Vcmef9eOHxwBSYnKxhoAETIwKYn0tN4ESDkoNf5SlY1XAaZ+cMqtPklCnjEvXgHE8NFDZQ9RkvvA5V7X+kjUAbDcMg5t+6DINHYXqe4vLqdCY0imLwDm3SbALH6YFkaWmDU6qPOBMo0lZg1H3PWiKQjqvKjURGWpWcOi6L4XPk6d90sl42wn+coIapaiMZTUeQPOIMZGVqHVo4Bmh7lTdr7P3fkSUsZ2M2C/U0zYURYSUyI7v87d2RNCxj5hTR5+TPFtk+MaGAbnJS1jbXI1+xmCc7O24dO+4zrD7oc7z9iZP+xP4Zlmdxpfa2eN0iapMcTuV1iNa7jzjJ2jQ9tkQLFHO616fokm5uWINAQGY8XQ/qBQHBCxdZ0PvqoJt1BwN4Jmeqz0+VxKPv8xqG08XNoo3nAjbdR4M3TVC0LsSHlc+JHyVKHvUhUs8ucsBT0LUj15mmhAy5m8bURHJ7kC8A+LV6Z1VPeX1gAAAABJRU5ErkJggg==">).</p><p>Coming back to the first equation, <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABEAAAALBAMAAABrDns0AAAAKlBMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADmU0mKAAAADXRSTlMAEKvvIt3NmXZEVDK768vscAAAAAlwSFlzAAAOxAAADsQBlSsOGwAAAF1JREFUCB1jYBCyvQsElxkYWGzDTNOM09IZGEQbGDIZtBiAYBUD4wWGaBCLgYHjAOMVCIu1geU2hDV3A+dNCOssA+cNMIv7EgPLVTCL6RYDw90JICZPAgNDqwADAwBGzBWlan4z/QAAAABJRU5ErkJggg=="> stands for a block permutation,
which is a one-to-one mapping that reorder the dates (from both
Post-Treatment and Pre-Treatment Periods). One example of a block
permutation is “shifting all dates forward by 1<!-- -->*<!-- -->“, so that in the
simplest example the original data would look like this:</p><div class="codeBlockContainer_K1bP language-r theme-code-block"><div class="codeBlockContent_hGly r"><pre tabindex="0" class="prism-code language-r codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">data.frame(values = c(40, 10, 20, 30), dates = c(1, 2, 3, 4))</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#&gt;   values dates</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#&gt; 1     40     1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#&gt; 2     10     2</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#&gt; 3     20     3</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#&gt; 4     30     4</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>and after our block permutation they become:</p><div class="codeBlockContainer_K1bP language-r theme-code-block"><div class="codeBlockContent_hGly r"><pre tabindex="0" class="prism-code language-r codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">data.frame(values = c(40, 10, 20, 30), dates = c(4, 1, 2, 3))</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#&gt;   values dates</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#&gt; 1     40     4</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#&gt; 2     10     1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#&gt; 3     20     2</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#&gt; 4     30     3</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>The case above is an example of <em>overlapping moving block permutations</em>
<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAASBAMAAADrvZC0AAAALVBMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAOrOgAAAADnRSTlMAZpkQ77t2RM0yVCLdiSQeunIAAAAJcEhZcwAADsQAAA7EAZUrDhsAAACJSURBVBgZY5B7BwWPGNCByVOQSN5zdHEGBg6IzANMGVZSZLgFwAZg0cP5GJcMw1mcMnUTQFJYTGPgdcclwyCnjaKHDRYcIDoA2TTmcjiQczNAlgGZDQHMR4ESWF3AAzQLe7jJgbQwmDwBUXEvQWwYcAIx5J64vFvA/M7FDyl+OF/DlKDT3AlAEQA/KUcCk+orJgAAAABJRU5ErkJggg==">, for the case where <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEQAAAAWBAMAAACLeyd9AAAAMFBMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAv3aB7AAAAD3RSTlMAZhCrmd0iu+92RM0yiVRhmm16AAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAw0lEQVQoFWNgAAEhMImNuAoVZP6ITRYoxvT6B1SGJQiHkh+2MCU4FACFeaiphK20E6dNUItWH7gvAFHD+h8GFKCaIEqY2hjkHSAiPKtgAKoC6lwWAQZ/qCkwCQQNNYWBIT4BIYjKgnmaCbfnYUr4PqNqReLBlLDAogiXjxgYWL9B9cF9tAZmEMwU/QaYCAbN+T8BLPbeAEMKKrCjo6PjL4iNO1jgWvsV4EysjPUTOL9glUAI+k+Qx+kUqKr0rXUI9VhZAMZKRrO6jQg+AAAAAElFTkSuQmCC">, and is the default block
permutation from the Augmented Synthetic Control package to calculate
point wise confidence intervals. The elements of <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAASBAMAAADrvZC0AAAALVBMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAOrOgAAAADnRSTlMAZpkQ77t2RM0yVCLdiSQeunIAAAAJcEhZcwAADsQAAA7EAZUrDhsAAACJSURBVBgZY5B7BwWPGNCByVOQSN5zdHEGBg6IzANMGVZSZLgFwAZg0cP5GJcMw1mcMnUTQFJYTGPgdcclwyCnjaKHDRYcIDoA2TTmcjiQczNAlgGZDQHMR4ESWF3AAzQLe7jJgbQwmDwBUXEvQWwYcAIx5J64vFvA/M7FDyl+OF/DlKDT3AlAEQA/KUcCk+orJgAAAABJRU5ErkJggg=="> are
indexed by <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAPsAAAAZBAMAAAAF0EUcAAAAMFBMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAv3aB7AAAAD3RSTlMAZhCrmd0iu+92RM0yiVRhmm16AAAACXBIWXMAAA7EAAAOxAGVKw4bAAADdElEQVRIDa1Vz0tUURQ+8970dMYZnaJFuzebFkHUtGqhoX9AoBQGUTCzCyKwTdBCmgFJRhCdPyAaiSjJSiGMwoVDi4gQnEWuWoyrEFpoZSlZvs4995377n3zdIS86Lvn+75z73d/D8Be5cX5vZTD4K2HU/t2c3Lz3b76/4rHyxXVxTEVqWBxVYRO90KPokSwYiAfPM1frgW8veCXXMDpUXqAkP2XSfsbR0HtUbheATcYJVhft4MMFbUNW2ubCsHQ2PNb/bvvPzbmAk6LziyWCFmqq/glTfZDsnd+ACR+B+L2BdUmIOETgOXVFbGSBehFazunKC3oGmmUJJQT1CQ9JNH+gz3/1OhUlL2YeXVDZV3HaBJHk8b/qLJckmxr+y7R6WRWpotvlL3jrQIs40BlSc3hkfGm0D7DlFkf3J4yF1eD5lH2MJ9F+11OSmB6zEMqXmPKrEP2zp0xpZ+66xUkoKVxBxAU60qOnD2p7vcgCbd9R0ehOGQ/U2vwMiV2Hvm58lxWyT4XtI+cvZDzWhJAu7pUQVMVmfbWKLh9vtbgADq3BNU4qH1sOyvyuQxpt4U5VbP9ZEFQ8Qz0Z6TWGZxrd1RQB5798hXZg/81t8KQ8JiUJLFObSxcuYIkOjzPoz108uIyAbgl/BT78OOXPRY/tZXlDKrFtedSxE5FkT0iy/ZO8RXlqPenS63Z6V7aS8psefIBZutsJmtx7bncfCbLEybY3t75QlQnvm1U2tXlhTQNVt77gi9jFT375ATAgyBJXnsNmyHb91YkH+cn31aXF+SKtOF4Wr96sFYDeK150LXXsBmyPb96R375eoqXATGJgkjjmJIjnEGHk+E07RDEJpaWXm4A+LDFtVd7z/ZnS37nUK3ATEECKbp1wD9o82qSTXhCZliUm1UVJ2sAz6iEAB/o1soWzd+qP1u2X5eTwESne7DHz5ci/t4PI5G8XyH6TblcxheF4fRVwTrC3buNsyeIgyuXvRLlR3w6sAt5Mtmer72RzKIkYxlDZHjUYCEETbEJsYP+k6aSWJRE6OeD4UWVTkEImmITIofZSkI9CHqGad+hSwAM50w6BE0xjCxy6K+4ubAicL6gs+d0AOBD29ySEDSbNKEknc8b8/eaFEHM4lOiSrJPhSJg+NhgIQRNsQmdGG+iNML6fE1Dhx46g2+z2Ok/x+AWooVCDqUAAAAASUVORK5CYII="> and a permutation <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABwAAAAUBAMAAABscEDKAAAAMFBMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAv3aB7AAAAD3RSTlMAEKvvIt3NmXZEVDK7Zolgmdk0AAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAo0lEQVQYGWNgELL/DwSfGSCAxT7MNM04LR3KFW1gyGTQgnC4rRhWMTB+YIiGcDl+AmmOA4xfoEpBFGsDy28k7vwNnCBFMHCegfMHmN0UI8DAwP2JgeUriMtzgf8AAwPTLwaG/xOA3BcM8kAuTwIDQytQFcMGhvUNQAoB6h0QbCDLGIXH8gmFy/sXhcvzEYXLH4DEPcNwfwGCy/KHE8WkZzlASQAaSimCw1zODwAAAABJRU5ErkJggg=="> is
defined as</p><p><img alt="Equation 4" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAA00AAAC0BAMAAAC6WNpTAAAAMFBMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAv3aB7AAAAD3RSTlMAEInd76tmVDJEIpl2zbsdfr7eAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAaoklEQVR4Ae1de4gkx3mv2ce8dnZm7KwhcMrtBRss/yFmLeQ4EiKzltax/JBmIRJWEsJusAhxHjdLDIlD4uxiPVCClTmQjIPB2gm2sHD+2CPSkcTB2uV0EExI9qJTZCwJzZGzRWTs3ZN2T4p82qt89eyq6qqZ6p5H7+m6YLfr8dVXX3+/qa76vqrqRiiJkGkn0WraZkQN5BpvRqyRkieggeIufieBZtMmI2pgG+NbIlZJyUevgaMYXx59q2mLETVQrOP9tYh1UvLRa+ABjP9r9K2mLUbUQB7jg4hVUvIENDCD8dkEmk2bjKiBDt6vRqySko9eA1MY/9/oW01bjKqBdYy3otZJ6UevgTreG32jaYtRNZDF+K2odVL60WtgAuO50beathhVA+nwFFVjydDvYtxOpuW01SgawOk0Ioq6kqItYPxGUm2n7fprYAzjt/2pU8qkNDCJ8c+Tajtt118D0xhf9Kc+JJTXPb/33UMiyqjEGL8KcSrhHzzUWBmVhmg7D95jhhG7rgGnefOOj7xs5vRIZ55Z7kExgOJHDtqcy+5lVMavayyHLTJYL0Y4obU/9IQFp0wDRxRiZgQed5BqnmljEp9HG7qza9giZzB+7uvQg96L8YtV9J4nj2OcfH8Cj99KtN/H9gjmjDk5MV3HayZOgxf5r7T9V1l8M9UIzI7bNLKKo2mob2pLf8pGtny3R+AiBEOPGxCdKwiRPqWEgYv8OdEYa6R8wLrPNN5nGZOj3qlgwQnd/RNFBT7Ro1faPmT90dT5jyFDDfPv6MwGLPIZvLesNjD7MZaq4EsskuNXlWiocRtO1gYz1twRZh55if2mc9h3i3VckTMfwHv6k7+5zG50XbRdGPX2YW+cNhZHiEm3prLek5aYIhc38cEJXYILPFkTToH8qJ043jitzumiJ5YqCV31lCCeyMUlfGVN550RPbgj5py5n+sUQ0+lOBkqzu/iy20jL3uRZ2DMnyoyx6AcWjLFSVdtoYPfqOpZCJU5OjDnXGZlY2dNmiGnU5w0Befq+DMhmNDsCY6OMJ8kclrlYSZSnFTtZhv419U0j9/Hr9J8QuNbFrJhZqU4Kdq9roE/qiRl9Gs8Js0nVGrLwtFEQjgdqb9gbdk5eSr96K41a42BZhZOnzr3ScoxPN8blMhHMP5hV6Gl+dSVaiiFJk6FK5+v81FTb8+FU/7O7zdHsHIPclJXzgZ3WyvCDUrkJzD+X4WtJSrNJ0vZkLNMnFpbqGndd+nCaX0LTUX1r8e4p9zpBsXp6M4FfLCzs6OwGJDIf4vxbylcbVFpPtkKh5tn4nQbQqtWH6MDpzyYgNmRnMuZ4K7Rku4iRWgwIn8D4+/2UrU0n3oRDr7cwGlsHqGa1WfvwGniJMHp4uAFC3GccuA0GJG/gPd/OdSkkRGYT0bBCJIGTrMrCO1GwekpkLFkLK4OR+wxB04DEbmM97d6ii1Xn3pSDp7AwOkMtIAjPPeKxB85ORKcxPNOXIUuBiLyBL5cFQyd18B8cpIMrcDA6UaECvaNl/bn3uRZkGxceCeHJiVhLPARV9HYQETOLOFLbcHRdQ3MJxfF8PJ1nIpwsnDS7o+240QeOmhWX1wdkrACH3HlzQxI5MxmyEseuo8EzSfoC2pnKMwhVLHP3uw4PUpuZhVvhe5p8BkCH3HlLQxK5MwZfEB+dF1CguaTgRMR0qF1O070rjZhY8nwg8BHXJUWByPyfcZiu9IAiyZoPllw2tW2PJ0xtq1B8sPmDdStE0STqt+0wEdcFX4DEhnm5lsK11A0QfMpjFMGw3aeICyFcTKXMo0aQd3BxgQ+4hpwNwSIL/I3uhpRSZpPYZxK+g7G4sM81O4QsWqgIRorjOadcAIfcQ2kGJzI4DtyOyWSNJ/COE07nAvu8UkYoIHihhIT+Ihr0MgARf4HjO8NGOuxJM2nME4bYguALiRy4+RSk8Gg36TAR1wDfoMUGXYmvxZw1mJJmk9hnGoO57cbJ8dEXrvHASQEPuIasByoyLBW+IOAtRpL0nwK49TgO3NVCUncjdM6PmYSDyMt8BHXoI3Bipyt418JeCuxJM2nEE554jXKnVXE41E3Tq6fc5hHXzkCH3GVzAYtcq5j28uCUJLmUwinKbLbVOyDkqqAiBunzkjMJ6d/D5YpByxyYdeyNwz8046RW9XS0OK63wihCUxcRxYHihsnu3994BKLfiSusoHBi5xfCu+1RPA6yWXZ5sgjJk4tMtisWsRw4pQX7wAu3GOB18IpZpbAR1wlmz5EljyMCGwxhz6qh5LcvKfnjyZl4tQk072XLG07cZJW5pDnQ8JME1cpYx8iSx5mJFMjC2taSNR8Co1PTfDuFfSzr0xaJ07yqCycYdVubMCJKe4oEVfJvg+RJY9wpG1mzeoONbPYmi7+UMs+paUiJcz+1IJp+cyWhYUTpwqGEY0EwAn64tDCDD8jNoMPqlojfYis8emeKHbwnt5ud3paur6oEc3Ef621idM09IlXNOY84cSphU8ykiYe4jpU+QI4hA9eQ+WfwXVvR73/PkS23agt7/Gdcw3S7is7/F5tROG8grGDoXh7NUzkl2PilG9c/+x5W1UnTtvi1HXpplOR7sLWijOvsr+wsAAfa6HXhca8QtiHyAqXrtEahtaJAPY1VFfdlrkEtH7WRdor38QJva/+qrWOE6elYL1qang4WWXimf2I3I1vv2WZRttgkdXWjIzCrskQTi5qJ06K12bqmKt2Ivk+Ig9TsOngEG/me1u0pQ67RG+1b5yK4gg4tF2OK0V0uX1quHBSRfbhE5dmO3jKzWA2z98ImWWezCe0fSxdKrUW7YVZcQQciidO2GkSyvUReYiiFZVtI01uVJTivtvaG6ei446k+QTlG1UHUTLZPiIPUbKy8o6JJp5jLTW24rXojZOLvbp57wYX0eHKV0XmkmW+9mdGWOtb5lVlI8nkXW3Gb9vmQ/BoqtLHR1CeICuf24pxazsz6SHDCElCIvO24edqBOvhokiS1m0jReVyJB6SeDa+t75IXpqVaQRTzey8ZHtIIyGRhZxlA6UBfAewoPyARTMIFmHijQ2t+E4E+IBKG3Y581f/gCgTW4E8hzMWEnmIYpatC+P5mD4bcPasxBS2TN4rtrq/Jqv/jowd1khI5CEKugEL45ZQn7Nk9s5aiv/GvxJ8IzSrfCc0q4ybvRtOhMIUeZhCbNpNpZo9u5ckjfirsZnOhx7qKD+a8RO9Gku83BR5mAJpPsigofVYEwkYWAPnRsDML5Z9ft/uC/SrngTV6ETOO3ZTVGIt0sFicswJfRJavpraLDl2U5QVL4X//YDdcNKfOqX018A0TIZ5yDx1sCziaMyBnySwRlYT3ZxhFelqynxvPbC7Pq4Lrjzf1l99NHAh5RzPQ722maqLzUJmQZr20AC85lkJeoWW9Ljm34Fp8YooLarnN0VmryscFQnM1F7EabmpgZqCknn6vCm70MQxlFPWgeNMCDaGu/XEvK93WTqLb/ziw+vXP/zwA/fC2bCqfnc1abF8AMGgdFGW1tlKlEz7RDrpY89HTQ6aFnlt7HobDvzLp1pAuUsKSciAR7es4NTRPbxPiuN/8tqm1dR/4O46r6bTeCQN1NeA/Gn4I1iZoS7gKM3r7xBY0gxW+K5TKBg9k7zJyNi4ZDaWprtooEQfYB8BipqFqiH8Q+PHAEgM/3ioaQ6JUiMEU2ibIExX4m/8E81eu9fZY3DvRfJ4O2dRAhbezo01hJYCYwrVgoUgSzVbVk3ZgmIrT/O6auCrpHSMwKFqPncne2xJnB4FAvW5ta1SExa9wtH4S0+9WF875ePz0KfUJ9kGM5Uy6vQ7pzpRmxHHmnwD33Ht6HNYd0q+DZFTZwYt9ogrqjipe31QUxrAfjK1TMvMr1pKpWlgexnW0sUUnJRk76XlGk7axpmoODVjOQSpEOk/qYF6G6FpMQWXuWA1yfEJMuUWfEIQ9bm3gS+FJupKQ2nURwN5sgliwoITUnHSTjBHnUcU68pOVh+ZUpqwBqaIF69ixUnYTzDP0ObV29LxF2ZnzQFTGAbBNPSjgQoZmjbU8UlwwwFO+klV3c5FHn6jpnkyT7SRXn010CTm07o63xM1pd+IvENgXuTCdUk6aEmmj98IPqH5KYVBGo2ugc481FG2pjy4ID4psBuA18LHEPqSYC4dtDTDx2+EVmMcORXNpVfQANussiot19wn5Nm0YF0DbZItET8WCqsHD0SR1esKu1jO9qJJy7toYJLaNk258/VLVbTLx/xgnRA1iGUr5xqqAdyFtVYEb4PW0mkimgZmqfOBvBiBhiIMI7tzLK6suxOHQu4i5xxr3X0m/q5l3uy1falRH9Cq8BiUlxFqcJyCfSxZcpZw+iTXVAGfj64zmEmk2/eiq03WaNC5W0vYN/cTW2mRlU6TQYmGLNHxepWnSrEOAnTSBx/XX5wL7SnkPfsXWe2/Jl8tWGHxYJ9eHqblmc8I/mXmpxVJz+sqlrB71kjJAg3wD1aMkwcbD2UxVhVEx4IX911E0+cFQSWiu5zVg+PukoPglF59NVAhhhHZTUSsXRYCGIJzAA+88ZVfE+WopS5WydxeEZiZB230Ik7LDQ1MsT2wmeeXZUEAQ3CAJvMbVwKCIFvW8YjAeQ3NjeFRJSXppoFtaScN9pxaHUsjrVvzaZmnBjpy/jxtVWxezOE9+QmyTRxr/iGqp1dDA4GDJ2c/R21Fz2BiScL53GVLdpoVTwMFNrOglevcktI4TcQcZlrpIpSmxz4TY0onWrXN0LZjnruopK7YPqHRqpN3NoowbfOdNpZFcbQrHCici1bjsFHnTj9zLvpSwZDuYvZKwLhoGflLcgkkoPOKeb/XzYubB9GD95ih6lGrC8ksbNA+NDitvqNIWjurJFh0I66kNpyOvBzi3z0j88xydwKldBfUqocTSmmMaPbfG33h9MhBO0arjiqbKg7T4X0TnS1HxV7ZFpwyDWUw7FWfls/4KyqD8XNfhx4E3+95sYre8+Tx+O8ZkaJFaF7WkRG423mZ6DtSV3nJtV3JtqQ8FmWmV8SCExzjWPGqK4m2FUekzLRHsvhmWiA/TraqjLz2Kj1zJ/1/JmFesLQTeFHDxdFy8sq0HGoO8z2+5HPtUV262/5zkfIBdCYI8u36k3FH1lXKh/yjH0KRqYgR+OrggHB6etF8G9gQ34tN7vLun0S816NX2r41Zrn9ID9OlrPNXn24bUuisX76E6r7/8hki7ZIDjzaLcOKXV/UKH8h/nEzy3NPYy0TGRnrK9JcZtXlxzgK6gwpCuvgEF9/OB15ifXwKG3baEt4LlM/ppcU2UNeZJ4SkehXb5zIAZIBhAuch/w4WT7uU2dJStMfTpJNn5H8XvUxuWrbJ69wdW+cVufClaPnZMRUtSNmWTmbd8WHcV0SHQ6c0OML/zOYnilvTImMGKfsRd62dCvKHEUon2g+mCceEpx8pI5NM2KcxBf1gm87j52NJ/tUipNVcYN57s2eYMyl+WT9FqJVACMz2B8H+xNUL4BB9y5Jjrg/3cfVJs0nNL4VT5ObaX+yKm4w/elrnLc0n1CpbW2uVyY4TSTJNdmfjtRfkApQI06cSj+6a00l9IpL88mLmhMVb6jf+c8sntk0cTre2PtNySxzvH77Z0kq80enLsCmoP/YF8ddJAmPFE6fOvdJGi/+5017P63yT7lIBiZ9UmnzuVe48nnrerHz+7n5O7/fNKxwj3uR5pMHrSDJd2774l/WP0qSJeF13yIp0p/uv/XvPhe8XaZ28Pt/0iBfJwDvHez4vf/Wx8G13Fi4/aaFu1Bn4faFBTCum3BtVOH+md8os/TC3/ziH7+5e5JwRJIBTR2CfyZOrS3UlFubVPlc/Wl9C7xafHag0nePS/OpO5lWWiM/h1zjPPwv7+xgvANhhVAATtlPwLUj3gz0TeJInsKLsN379C6+VPw0It8hIV/Mwzei7zUw3ge0H4PUQTV3usFw+ha961X2GtaAAeF/GIKJ023w6nirZ9SBUx4M12ywycb3lqT55FuBnJCkoHyLg1HXxqfH1oDRLH/XbbFB53+7dOdpAV8qn4SjYhfJ3m98HshgaNuCCwD1RhUuEwynOs3LURYaA0KafDBwGpsnbxGzieXAaeIkuXFQQqQQmE/+1ZaYIzAPPYMEDae36RAzzQ+fzOBlQjHLunnj0qPwkKO16ixnid1ggcE1RXHK8v1a9LmnMyC8Eg8GTrMr5PuqNqkcOD0FtKXIh3MC88nWlDUvy/FBm8zBruF0sEjqiHPlu2xdZoq5puqXXoaH4N4aEGyz5aF1/pxmi3asVpkl0PpJoNMZQEbywcDpDEiEIzz3im9DhcnIOAXmk7cGNlgngbcAMC1rOLEdI1lMu1yOvxcjzx5onT25RXWWITdBRi4Yu4js5FdGruP8piuAk8GAUiX9z8DpRoQK9h3n9v40eZbcI7v9CLcSmE/elTZFL59mo6GGE+tAOSb5tDja0KA9r0MHJdrONHNc8LeAkhdNQmA4Vfh5mHHAyWBAqZL+p+NUhAF4UtymLpodJ/KchIHgvE7bMxXdfMrIXs6fbhpO7KwK/4WtiyfkLh1zOqIjkoGUEs6yjwXyo5gMpwk+qS8fg7N/OoOedzMKAh2nwpz+LlNFAjtOMETDBJENyApxr2h084mrGBjnmLI1nOjzDp4EFIYae6whmORVgb7DRyOIZtihhybraORFkxAYTpN47wRJkeVQgwHJTjzoOBFxHFq340Tl38Rr9Or/rxP5SVlmYw80kWfK1nBiFh/HqcOn5zBtIHJ1FOl2KWY7bEZLxmIIDKc8GFUfJLBCMBiwzIT/h3HaFScXqWRniHGohw+bIisqI0VLOjl8Fr1t1ohuPlXkS7PgyBbhpzQ6xp5joj9h0b2bFJWOcj9NAmHmLfbOSRiLSWA4QScCpF6lSBkMGFnC/0M4ZTCfoTLBQkoPH0A0aiATpvA2sxjmU4VjQU6UU/U7cYIdgjKQR1lHTEAgTid82YvjZEAlYzEJHCd4RzgE8qo7kwEjS/h/CKeSVAiVrChef167Q8Tob04RuyAfSSzz279nhD9XiGk0hvm0IcUCNa4AFydOgOMffIeFvyetqTiVMczBy4tjxJAYm6OyCJzQFyhQd9AfgsaAkSX8P4TTtMO54B6fhHnpfycxzKeWitMyNNUNJ4KjDCpOOfIahtmVInmIkveKk8D7E0Jf7hCk1kiH1RgwsoT/h3DaELMlQzA3Ti5kDQZKMob5xOfSwMTjubestKX1J3gmgw8JQIZne6vNqCROCH0F3PBz5LmnMVCZJRYP4VQLprGaUG6cKpHdsNHNJxTMI2BmtgaSsf70T0RG1zyClOnPPZjjrKD/Jg6kKno/Kw76E6QzNdJt5TyCUxyGSwinhuMAqRsn9aMEfrcU3XwCn4dY5IJJCGmF4XQriRo4dfAxkitCR5lHgNGxmIEhijih+HSP41Q5QekLZBZlMBCMEr2aOOWJPnJnwzK5cXL1wDAPkRPdfAIsmPuVOBXohNSN07buHtFwquCLZCMa+J7yYt8ge+5VjjHhauCCMhgIqRO9mjjRPfVi95YqmRsnTRFqFWc8uvkE1i3z4ZH1P+p9cOO0IWdC2SqIoIk3id+aXiRzh9fFdE/0J/7TJNuYDAbO2xhlgYnTBJ4D19FKWAQ3TtLzFq5kz4ERZtle0iVXmqvc68vUT9bWzecenXxTTq01uGg4warh7AliIr0jP3LO+xN3qpcBJ4MBZZX0PxMn+i7TVYtUTpzy+LKFvFsWrKu2tfKvflZLWhPrwsvAI8xtAmNNCKfgNdRPk1INJ9TA8HkzyDwQ0z3Rn2CmTkIZuq3BgBUk/N/EifpaXrII5cTJMIwtVc0s03zyck9MCpfgElspoqNikQ4yxjwCXEBt2mSRPiB1nDbZr6qJfyakYuafeH/UOPnR6QwEYaLXME5VVJALa4poTpy0j3woFdzRWTYTkARlLEcUmReOdFi3zfJ3RK+TWR1bQprkvr8sn2uUuaEwDY9weMGkOt9D68QjQRxIFEMSnaIWdIV31w2CvM6AECUeTJxaMC2f2bKI5cSpgqk6LFUcWcWO8ZpnwIkqz0HPs3+JaXJ9f41mTJNm2WbaGT5CQj9t07JdNje8m6Sgsx6jmewff5e48uOaoehWuAidk4ROZaBUTjBq4kReVPGKTR4nTi2xjGCrFcp7fOcc7MvCe6/sUIXQ8qzfR+aXiJO0hF9kPKkB8TTkHL0A/A5+jKbIvq+9HciBLvKr8P/RT8EiyE4dcl/5KatDi2i7cotUmdZ+DVUOaitQPEnn/AoDWTHhiIlTvnH9s+dtMjlx0j7GYqup5dXwAg0N1Ynx7Kd/WyOyJwr1S//2h5jO8AjBA/jV46QbzlJ+e2h8n0QaBCf0CH75T99PYM3RzAVhe5HVqzVCkBEzzgohaLyJKq9n9z748F+IvicZEOLDEEyc0Pvqr1rlcuK0pKzvWGv6ZP6rD1H+hsad/xIQHq9/vB2k9NiXn99/zl7I5w9PUTyDSuMn0HUd/JHfFTluBoJitNcQTq7mnTi5HE0uRtb8f7TmpplSA33jFBgbkmeMSDCAxKh8LVTxxqm1aFdHVi6I28v9ctmRCT/aa5LKG6eiQz3KDNdB4ZFdtFlsHvWuHRJvnFwqib55z8Ip7iFdC6t3ada0ly/AfvNPvAb52451RXsVR+7EsqMgzeYagO95UR9ZDIXAAngVZRrMMoxRX6lynxJPozYNgO8aVppjBdhJ1YZdzh+LVVmvNLz3mOjtXL0pcH8x/2b0WyiTpbvV/bXoNc0a9DSBmZmmNQ005EKplu2RKOFbYBH8Fg/KXiTNdi+KtHzTXLTzVkmm86GHOrCbov9wc/8s3vUc1nW/f5T7zT6/b/cFRmGS0vppACbm836UKVWSGoCJBN8akKQUads9NdDB+4aPv2eVlCABDWzE2E2XgJjXfJN9WLrXvO5GqgA4pLA20gbTxmJpAFzmsOMjDYddA/DlAr6f6rBLeo3L902M4bhjGg67BjIwQi0fdiFT+ci+RHwltaGugl/Co4foU1dXgbqSE7EW7ItPToi05Z4aKC7FXdXtyfrdSvD/4v2xmU9ZtVYAAAAASUVORK5CYII="></p><p>So reading back the equation and using <em>overlapping moving block
permutations</em> <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABwAAAAUBAMAAABscEDKAAAAMFBMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAv3aB7AAAAD3RSTlMAEKvvIt3NmXZEVDK7Zolgmdk0AAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAo0lEQVQYGWNgELL/DwSfGSCAxT7MNM04LR3KFW1gyGTQgnC4rRhWMTB+YIiGcDl+AmmOA4xfoEpBFGsDy28k7vwNnCBFMHCegfMHmN0UI8DAwP2JgeUriMtzgf8AAwPTLwaG/xOA3BcM8kAuTwIDQytQFcMGhvUNQAoB6h0QbCDLGIXH8gmFy/sXhcvzEYXLH4DEPcNwfwGCy/KHE8WkZzlASQAaSimCw1zODwAAAABJRU5ErkJggg==">  for <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAaBAMAAAAktUMMAAAAMFBMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAv3aB7AAAAD3RSTlMAZpkQ77t2RM0yVKvdiSIpHFlyAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAiUlEQVQYGWOQ/w8FnxigwOQriJH/HcZn4IAIfIALsNJcgNOLgQHFFjagc1AEQI4hTSD7qAEDsl9YBfgDGBhMvgBFGeJ/AolrDPYBDPJfXP4vYP7v4g8MjwkM6xOA4shA/wEyD8h2QePz/UYTYPyIJsD6GU2A/wCKQCiD/AJkAb6v7Ghm3mgFKgAAym9CpKfnoOUAAAAASUVORK5CYII="> , we can translate the
equation as “The probability that the residual <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAARBAMAAAAmgTH3AAAAMFBMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAv3aB7AAAAD3RSTlMAIs0yRO9UZokQu6t2md3bjgcsAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAf0lEQVQIHWNgYGBgVAYSIOCqnwCm2cNYIsCMSQIMswzALHQiKXoCA0MPAwPbSvsLDMyfGBjmTchfwMDzg4GhgmF/AgPXF6AGzq8MDPwfgAz2vwwM/gpABki4vwHI4PvIwKDvYMXAwPSTgeU/w3Wgmj8MSfqCD4Byde8uzH4kAACARB3IVUvkFwAAAABJRU5ErkJggg==">  was caused just
by noise is the share of dates where we had an error smaller than
<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADoAAAAZBAMAAACSrSCDAAAAMFBMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAv3aB7AAAAD3RSTlMAdrvd782ZImaJVDIQRKvcdQ0fAAAACXBIWXMAAA7EAAAOxAGVKw4bAAABl0lEQVQoFU1SPUsDQRScGPUul7szvYUB7RWENIqxET8K8RMLxViIARsFLcRGi/QJiJVIQv6A+QceipWFKexT2ApGMcZE4zlvLyH7YOfNzNuPt3sH6GFpQufKtpe1amgrEKHhmbSZI7+PKcPYVOlCoZUo2Zl8gXxbaTynRKAnLlgpA1HfA0K/ImEuOPOSjW+C/S50leMp2PjhEHcl8fIeV/wI22sr4Z044+yIbIBBjo+O3c7hacDx04Fy1DRr7ZUr1BmROgtvfu1a6hF1RPHxC7hdEsOSjqwR359gdmWqPWnxgKEcKaKcxzg9+CT2VQlmzm0Co2WxjT9BrkhShqXKe00DvmKowTkXliWqtaQ7cGriwf6AS58HlfhywVNx10hDPNm5NydkhcNVPSN5iL5WNE7DaeBsVgpjBLNFAFIeKtX+czKziezuFU6mPAojuEA2Zq3Xj6jhVrFvXPqLZRFYU2iOJ+yXDaEDcWW04Yat6SGfthvheJcLk1a7EeUraWHJy2qR8TSB44Ku+CNMatqe04SiRc3oYU//hihnkmEBXAQAAAAASUVORK5CYII=">. where <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAARBAMAAAAmgTH3AAAAMFBMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAv3aB7AAAAD3RSTlMAIs0yRO9UZokQu6t2md3bjgcsAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAf0lEQVQIHWNgYGBgVAYSIOCqnwCm2cNYIsCMSQIMswzALHQiKXoCA0MPAwPbSvsLDMyfGBjmTchfwMDzg4GhgmF/AgPXF6AGzq8MDPwfgAz2vwwM/gpABki4vwHI4PvIwKDvYMXAwPSTgeU/w3Wgmj8MSfqCD4Byde8uzH4kAACARB3IVUvkFwAAAABJRU5ErkJggg=="> refers to a Day of Interest (DoI) in the
Post-Treatment Period, and the dates included for the analysis are all
dates in the Pre-Treatment Period and the DoI itself.</p><h3 class="anchor anchorWithStickyNavbar_31ik" id="estimating-the-confidence-interval">Estimating the Confidence Interval<a class="hash-link" href="#estimating-the-confidence-interval" title="Direct link to heading">​</a></h3><p>The confidence interval is estimated by repeating the estimation of the
p-value for a range of G values
<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAOoAAAAXBAMAAAD3ts66AAAAMFBMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAv3aB7AAAAD3RSTlMAMonN3ZlEIrt2VBDvZqv3LW7dAAAACXBIWXMAAA7EAAAOxAGVKw4bAAADIklEQVRIDb2Vz08TURDHv+2yXdrd/ogX9UT/AzhwMWA0WhMJJO3NY2tiPJHQG5CQ4IGbMZB48KAJ+xcICR48aWPwopWS4J2DVwUUqohInXnvbbdvf0BPTsLbmc/MvHk/5lEAuDRaulOjb5xcub0d5YrBUaFILF0P8Ll2HfNHtQD1zeSJ9du3uloM7vo1ZdhdXNFA5qhO9uuoiWVctYavWsa5OCISMH8i19A8M7+E2dLX4odk2sCq69tKi8GhOAHWKkifaK6WvLQhWVxzCcP5Q1XDS4rB4XwmrXWktcNMd2SgcRadgN0KUC2GnDE4FMcgS8dl/uh1GcfmOtm5pKre6xN6qwDcCO81BofSGTjfAUPba75tdFiynbrIGBAWD7wYWucpDR2X1V6Jwb0hvr7bAPLavXpVMx3aE0nioSfCRE6sglaws/dEEjF2sfVC5vX4Quo+z0Ht4YtzZlyenZ1dSKu9+R6pOX+B5CFdwRg2HvlODztb5YurcsMOj4jkl1Ob9/AYuSM5lam+/sRSy1NvD9Dp7NZh91yNh4H9i6vy5ZVdnm94omA/eHoTKbVHR+sxWZHHtwfA0E1ginT+U+Lhfqra1KgJsanpD5xerlB/FsVEaw3xCQ154lUXNh0ylmnNShQmq4+9UkOa3EyZUzHBWg1YoLYG7BapLMEedhqwqGLqmHz7LkcIUZj0Pqo2gcURClX/iRZJTTQLNL7yGrvbw/eJkpgHMD7SMkXVbSq/1YtJl1UVxnSFQt4TFoqMRRUYXydWLtJAj5GHN+0Crh7WWY0Q6509ShndqoPyhSlMCbKqwlimBzLIrSKVgphxobgxSYrXQrLK/PjULemWtj7OlVY4wzvh1CabgMSkqL0qrO9VQWtpglOSMc+EfdHid1N2W49Q9xrEIkiHSV55arNUKuoznGOVySdejhk4FlU1iMVUOszwO4BdHRO+vobVAizxpI1AuKoaxCJKhzb94JEsBw4rMJ9mDk5iY4TJNw3Te3cFCOIoOMM9ZamfGRFw4bCzd41jUhUt0mg2m5/CWMYEYpFpPoP1eVSb4D8Y2S+nd5+ngH8leRqkwwm21QAAAABJRU5ErkJggg=="> by subtracting from the
observed value of the treated unit at the DoI. The reason why we
subtract a value <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA0AAAARBAMAAAD00TuvAAAAMFBMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAv3aB7AAAAD3RSTlMAMrvdzWaJVCJ2mUSr7xAezV/4AAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAf0lEQVQIHWNgYGAQMgkAkgxs3zl+guj1GxjOAin2XwwM8wsYGHj/AekJDAzxC4BSCQwM9wUYGPwnMLD+Bar5X8DA8x8EHjDwfgWa8IWBgf8HAwPzdwaG9x8YGOQNgPwLQG0FQGMuMHAApRm4PjCw3APSHNf4nB8AaYYm4wlAEgCYTiRxnHis3gAAAABJRU5ErkJggg==">, can be thought of as ‘removing the real
effect that the treatment caused’, so that when we remove the treatment
effect perfectly, our algorithm above should indicate a high p-value.</p><p>Let’s take the scenario where we have our target value in the
Pre-Treatment Period following a normal distribution of expected value
(1.0) and standard deviation 0.1. With the treatment, the expected value
of the target increased by 30% while keeping the same standard
deviation:</p><div class="codeBlockContainer_K1bP language-r theme-code-block"><div class="codeBlockContent_hGly r"><pre tabindex="0" class="prism-code language-r codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">  days &lt;- 100</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  post_treament_start_day &lt;- 70</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  expected_values &lt;- rep(1.0, days)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  expected_values[post_treament_start_day:days] &lt;- expected_values[post_treament_start_day:days] * 1.3</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  observed_values &lt;- rnorm(days, expected_values, 0.1)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  dummy_data &lt;- data.frame(date = seq(days), Y = observed_values)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ggplot(dummy_data, aes(x = date, y = Y)) + </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    geom_line(color = &#x27;skyblue3&#x27;) + </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    geom_vline(aes(xintercept = post_treament_start_day), linetype=&#x27;dashed&#x27;, color = &#x27;gray20&#x27;) +</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    scale_y_continuous(limits = c(0, 2))</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p><img src="/GeoLift/assets/images/ConfidenceIntervalWalkthrou_Lift_high_explanation-a650fd24f16cc34fd1a46c5115cd11f5.png"></p><p>Which means that for the null-hypothesis “the probability of observing a
data as or more absurd, assuming that <em>there is no increase</em>”, we expect
to obtain a quite low p-value. After all, we can clearly see the
different level that Y is in the Post-Treatment Period. But what if we
wanted to estimate the p-value not for <em>no increase</em> but for an increase
of 20%? In this case, we <em>subtract</em> 0.2 from all the values in the
Post-Treatment Period from the treated units:</p><div class="codeBlockContainer_K1bP language-r theme-code-block"><div class="codeBlockContent_hGly r"><pre tabindex="0" class="prism-code language-r codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  altered_dummy_data &lt;- dummy_data</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  h0 &lt;- 0.2</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  altered_dummy_data$Y[post_treament_start_day:days] &lt;- altered_dummy_data$Y[post_treament_start_day:days] - h0</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ggplot(altered_dummy_data, aes(x = date, y = Y)) + </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    geom_line(color = &#x27;skyblue3&#x27;) + </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    geom_vline(aes(xintercept = post_treament_start_day), linetype=&#x27;dashed&#x27;, color = &#x27;gray20&#x27;) +</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    scale_y_continuous(limits = c(0, 2))</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p><img src="/GeoLift/assets/images/ConfidenceIntervalWalkthrou_Lift_low_explanation-f550906b2f6431f1805497a09f735deb.png"></p><p>As we can see with the plots, the target values at the Post-Treatment
Period are much closer to the values in the Pre-Treatment Period. As a
consequence, we expect the p-value to be much higher than before, but
still (from looking only at the plot) the p-value should be below 0.5 as
it looks that most often the values in the Post-Treatment are above the
values in the Pre-Treatment Period.</p><p>Now what would happen if we removed <strong>exactly</strong> the actual increase we
got from the treatment?</p><div class="codeBlockContainer_K1bP language-r theme-code-block"><div class="codeBlockContent_hGly r"><pre tabindex="0" class="prism-code language-r codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  altered_dummy_data &lt;- dummy_data</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  h0 &lt;- 0.3</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  altered_dummy_data$Y[post_treament_start_day:days] &lt;- altered_dummy_data$Y[post_treament_start_day:days] - h0</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ggplot(altered_dummy_data, aes(x = date, y = Y)) + </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    geom_line(color = &#x27;skyblue3&#x27;) + </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    geom_vline(aes(xintercept = post_treament_start_day), linetype=&#x27;dashed&#x27;, color = &#x27;gray20&#x27;) +</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    scale_y_continuous(limits = c(0, 2))</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p><img src="/GeoLift/assets/images/ConfidenceIntervalWalkthrou_Lift_none_explanation-4ce7419cf1ed46ad8c4448f538196168.png"></p><p>We don’t see any difference between before and after the treatment, so
the p-value should be quite high. So by applying a shift to the target
values at the treatment locations at the Post-Treatment Period, we are
assessing the likelihood of each one of the shifts. After we execute
this process several times, we obtain the p-values for each one of the
possible treatment effects considered, resulting in something that looks
and works <strong>similar</strong> (It is not!) to a probability density function of
the treatment effect.</p><h3 class="anchor anchorWithStickyNavbar_31ik" id="implementation-of-the-algorithm">Implementation of the algorithm<a class="hash-link" href="#implementation-of-the-algorithm" title="Direct link to heading">​</a></h3><p>The Conformal Inference method proposed by the authors and used by
GeoLift mainly consists of the following steps for each day in the
post-treatment period (Algorithm 1 from the paper):</p><ol><li>Subtract to all treated locations in the Day of interest (DoI),
which is in the Post-Treatment Period, a constant H0.</li><li>State the DoI that is originally in the Post-Treatment Period to be
in the Pre-Treatment Period</li><li>Train a new Augmented Synthetic Control Model (though it could be
any Synthetic Control, Difference-in-Differences, or Factor/Matrix
Completion model) based on the new data. I.E. on a data where the
DoI is considered to be in the Pre-Treatment Period for all
locations</li><li>Collect the residuals (i.e. the error / the ATT) between what the
new model predicted</li><li>Apply a ‘cost’ function to the residual of each day (e.g. abs(resi))</li><li>Observe for which % of days in the Pre-Treatment Period (again,
which includes DoI) the model had a higher ‘cost’ than on the DoI.
This gives you an estimate of the ‘p-value’ for the DoI and step
size H0: “The probability of observing a data as absurd or more than
this, assuming that the effect is H0”</li><li>Repeat steps 1 ~ 6 for a range of values H0 to obtain the ‘p-value’
for each magnitude</li><li>To find the limits of a confidence interval of size (1 - alpha),
select the lowest/greatest value H0 where the p-value was greater or
equal to alpha to obtain the lower/upper bound</li></ol><p>We demonstrate below how to implement the method and show that the
output is aligned with what GeoLift does for the first day of the
Post-Treatment Period (i.e. day 91):</p><div class="codeBlockContainer_K1bP language-r theme-code-block"><div class="codeBlockContent_hGly r"><pre tabindex="0" class="prism-code language-r codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">library(augsynth)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">day_of_interest &lt;- 91</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">h0 &lt;- 0</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">cost_funct = function(residuals) return (abs(residuals))</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># We create a copy of the original data we can alter without worries</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">new_geo_data &lt;- GeoTestData_Test</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># 1) Subtract to all treated locations in the Day of interest (DoI) a constant H0</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">new_geo_data$Y[(new_geo_data$time == day_of_interest) &amp; (new_geo_data$location %in% treated_locations)] &lt;- new_geo_data$Y[(new_geo_data$time == day_of_interest) &amp; (new_geo_data$location %in% treated_locations)] - h0</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># 2) State the DoI that is originally in the Post-Treatment Period to be in the Pre-Treatment Period</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">pretreatment_period &lt;- c(1:(post_period_start - 1), day_of_interest) # define which days are in the Pre-Treatment Period</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">is_pretreatment_period &lt;- GeoTestData_Test$time %in% pretreatment_period</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">is_treated_unit &lt;- (!is_pretreatment_period &amp; GeoTestData_Test$location %in% treated_locations)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">new_geo_data$D &lt;- as.integer(is_treated_unit)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># 3) Train a new Augmented Synthetic Control Model (though it could be any Synthetic Control, Difference-in-Differences, or Factor/Matrix Completion model) based on the new data. I.E. on a data</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">synthetic_control_model &lt;- augsynth::augsynth(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    form = as.formula(&quot;Y ~ D&quot;),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    unit = location,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    time = time,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    data = new_geo_data,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    t_int = post_period_start + 1, # +1 because we sent the DoI to the pre-treatment period</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    progfunc = &quot;none&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    scm = TRUE,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    fixedeff = TRUE,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#&gt; One outcome and one treatment time found. Running single_augsynth.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># 4) Collect the residuals (i.e. the error / the ATT) between what the new model predicted.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">residuals &lt;- predict(synthetic_control_model, att = T)[1:post_period_start] # here we already select that we will use only from the Pre-Treament Period</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># 5) Apply a &#x27;cost&#x27; function to the residual of each day (e.g. abs(resi))</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">costs &lt;- cost_funct(residuals)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># 6) Observe for which % of days in the Pre-Treatment Period (again, which includes DoI) the model had a higher &#x27;cost&#x27; than on the DoI. This gives you an estimate of the &#x27;p-value&#x27; for the DoI and step size H0: &quot;The probability of observing a data as absurd or more than this, assuming that the effect is H0&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">p_value &lt;- mean(costs[day_of_interest] &lt;= costs) </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># Observe that the result is exactly what was in the output of GeoLift</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">print(p_value)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#&gt; [1] 0.2857143</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">print(GeoTest$summary$att[day_of_interest, ])</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#&gt;    Time Estimate lower_bound upper_bound     p_val</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#&gt; 91   91 108.8099   -82.98491    300.6048 0.2857143</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>As you can see, the p-value we obtain matches perfectly with what
GeoLift shows. We obtain the confidence interval by repeating the
previous step for a range of values of H0, and collecting the p-value
associated to each H0 value:</p><div class="codeBlockContainer_K1bP language-r theme-code-block"><div class="codeBlockContent_hGly r"><pre tabindex="0" class="prism-code language-r codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># 7) Repeat steps 1 ~ 6 for a range of values H0 to obtain the &#x27;p-value&#x27; for each magnitude</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># Let&#x27;s then put the previous code in a function</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">get_p_value = function(h0){</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  new_geo_data &lt;- GeoTestData_Test</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  pretreatment_period &lt;- c(1:(post_period_start - 1), day_of_interest)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  is_pretreatment_period &lt;- GeoTestData_Test$time %in% pretreatment_period</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  is_treated_unit &lt;- (!is_pretreatment_period &amp; GeoTestData_Test$location %in% treated_locations)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  new_geo_data$D &lt;- as.integer(is_treated_unit)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  # the only change: we subtract the related impact from the observed values</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  new_geo_data$Y[(new_geo_data$time == day_of_interest) &amp; (GeoTestData_Test$location %in% treated_locations)] &lt;- new_geo_data$Y[(new_geo_data$time == day_of_interest) &amp; (GeoTestData_Test$location %in% treated_locations)] - h0</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  synthetic_control_model &lt;- suppressMessages(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      augsynth::augsynth(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      form = as.formula(&quot;Y ~ D&quot;),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      unit = location,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      time = time,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      data = new_geo_data,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      t_int = post_period_start + 1,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      progfunc = &quot;none&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      scm = TRUE,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      fixedeff = TRUE,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    )</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  )</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  residuals &lt;- abs(predict(synthetic_control_model, att = T)[1:post_period_start])</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  reference_residual &lt;- abs(residuals[post_period_start])</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  p_value &lt;- mean(reference_residual &lt;= abs(residuals))</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  return(p_value)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># As we got for day 91 an estimated ATT of 108.810 let&#x27;s try  a wide range of values from there.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># Let&#x27;s try a wide range of values based on the expected ATT for the DoI. We are going to use 6 standard deviations which would be more than enough if the distribution were normal</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># We use the same parameters as the default of GeoLift for comparability</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">grid_size = 250</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">sd = sqrt(mean(GeoTest$ATT[post_period_start:post_period_ends]**2))</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">grid &lt;- seq(GeoTest$ATT[day_of_interest][[1]] - 6*sd, GeoTest$ATT[day_of_interest][[1]] + 6*sd,  length.out = grid_size)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># We calculate the p-value for each one of the defined H0</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">p_values &lt;- sapply(grid, get_p_value)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># 8) To find the limits of a confidence interval of size (1 - alpha), select the lowest/greatest value H0 where the p-value was greater or equal to alpha to obtain the lower/upper bound</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># Let&#x27;s suppose we want the 90% confidence interval:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">alpha = (1 - 0.9)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">lower_bound &lt;- min(grid[p_values &gt;= alpha])</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">upper_bound &lt;- max(grid[p_values &gt;= alpha])</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">print(lower_bound)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#&gt; [1] -75.93094</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">print(upper_bound)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#&gt; [1] 293.5508</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># which again, will be similar to what GeoLift stated:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">print(GeoTest$summary$att[day_of_interest, ])</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#&gt;    Time Estimate lower_bound upper_bound     p_val</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#&gt; 91   91 108.8099   -82.98491    300.6048 0.2857143</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>As you can see the values we got are almost exactly the ones provided by
GeoLift, with the difference originating from the grid of tested values
being different.</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="the-backfall-jackknife-method">The backfall: Jackknife Method<a class="hash-link" href="#the-backfall-jackknife-method" title="Direct link to heading">​</a></h2><p>While Conformal Inference is proven to be robust in many scenarios, it
is not guaranteed to work everytime. Most commonly, Conformal Inference
can fail when</p><ul><li>there is not enough days in the Pre-Treatment Period</li><li>the true impact (called in the paper as Shock Sequence Ut) is not
stationary or not weakly dependent</li><li>the data is not stationary and not weakly dependent when our model is
misspecified or inconsistent</li></ul><p>When Conformal Inference fails, GeoLift falls back to the second method
called ‘jackknife+’, which works similar to Conformal Inference in the
aspect that we alter what constitutes the Pre-Treatment Period. In
Jackknife+, for each day <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEIAAAAZBAMAAAB3M+XvAAAAMFBMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAv3aB7AAAAD3RSTlMAu92rZhCZ70TNIlR2MonPr+y8AAAACXBIWXMAAA7EAAAOxAGVKw4bAAABXElEQVQoFWNgYJD/DwSfTBhwA9b8UgaGCPlZuFUw2BsAJbm/B+BWUu8AkssHqcMOuP4vAEn0f8UuDRRl+Q6W4v+NUwXzZ4iKPzhVsH8BS63Hbcb9X2AV/n9xmnG+ACxlD6GwKZMHe5P1/wNskmAxSHDwQXyETRUvJDju/wBKZs4NmyjLwMA28cJDwwQg/7Lg5AAGBh6wZlb9DUCmw/QZDP4XGI5wFl5gAfqQUYOBD6iQERwc7RVALUwM+gEM/AYMCkx/Gfi0GBjmL2C46cDAsB4YUlye34CmMfCyAlXHT2C4EC8A5AEDW1gwF5Y6REAKgBEMNHp/AhA7gHjMWMKQDRh49g1AvACkgg1LGDJ9YOD6BpQrBylg4AaZcQrMhBPrvzAsMgA6CxKXDJIBDJcT4JJghr+foAWQwVsLEeYRnAl0KQqA2I8ihMaB2I8miMzl/YjMw8Y2r4c6AFkSAAlHWnvXk9LcAAAAAElFTkSuQmCC"> in the Pre-Treatment Period</p><ol><li>We remove it from the Pre-Treatment Period and put it on the
Post-Treatment Period</li><li>We train another Augmented Synthetic Control Model</li><li>We calculate the absolute difference (abs(e)) between what was
observed in <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEIAAAAZBAMAAAB3M+XvAAAAMFBMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAv3aB7AAAAD3RSTlMAu92rZhCZ70TNIlR2MonPr+y8AAAACXBIWXMAAA7EAAAOxAGVKw4bAAABXElEQVQoFWNgYJD/DwSfTBhwA9b8UgaGCPlZuFUw2BsAJbm/B+BWUu8AkssHqcMOuP4vAEn0f8UuDRRl+Q6W4v+NUwXzZ4iKPzhVsH8BS63Hbcb9X2AV/n9xmnG+ACxlD6GwKZMHe5P1/wNskmAxSHDwQXyETRUvJDju/wBKZs4NmyjLwMA28cJDwwQg/7Lg5AAGBh6wZlb9DUCmw/QZDP4XGI5wFl5gAfqQUYOBD6iQERwc7RVALUwM+gEM/AYMCkx/Gfi0GBjmL2C46cDAsB4YUlye34CmMfCyAlXHT2C4EC8A5AEDW1gwF5Y6REAKgBEMNHp/AhA7gHjMWMKQDRh49g1AvACkgg1LGDJ9YOD6BpQrBylg4AaZcQrMhBPrvzAsMgA6CxKXDJIBDJcT4JJghr+foAWQwVsLEeYRnAl0KQqA2I8ihMaB2I8miMzl/YjMw8Y2r4c6AFkSAAlHWnvXk9LcAAAAAElFTkSuQmCC"> and what the model estimated</li><li>For each day in the original Post-Treatment Period, we collect the
difference between what was observed and what the model predicted.
From this vector we create 2 others, one where we add abs(e) and one
where we subtract abs(e) creating respectively the upper and lower
bound for this iteration</li><li>We store these lower and upper bound values</li><li>The confidence interval is then obtained by getting the respective
quantiles from the upper/lower bound</li></ol><p>As before, below is a demonstration on how Jackknife works:</p><div class="codeBlockContainer_K1bP language-r theme-code-block"><div class="codeBlockContent_hGly r"><pre tabindex="0" class="prism-code language-r codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">train_augmented_synthetic_control = function(geo_data, treatment_start_date){</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  new_geo_data &lt;- geo_data</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  pretreatment_period &lt;- 1:treatment_start_date</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  is_pretreatment_period &lt;- new_geo_data$time %in% pretreatment_period</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  is_treated_unit &lt;- (!is_pretreatment_period &amp; new_geo_data$location %in% treated_locations)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  new_geo_data$D &lt;- as.integer(is_treated_unit)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  # 2) We train another Augmented Synthetic Control Model </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  model &lt;- suppressMessages(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    augsynth::augsynth(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      form = as.formula(&quot;Y ~ D&quot;),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      unit = location,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      time = time,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      data = new_geo_data,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      t_int = treatment_start_date, # since we removed the date from the Pre-Treatment Period and put it in the Post-Treatment Period</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      progfunc = &quot;none&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      scm = TRUE,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      fixedeff = TRUE,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    )</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  )</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  return (model)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">jacknife_estimator = function(geo_data, treatment_start_date, treatment_end_date, iteration_day){</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  # Make a copy of original data</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  new_geo_data &lt;- geo_data</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  post_treatment_days &lt;- treatment_start_date:treatment_end_date</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  # 1) We remove it from the Pre-Treatment Period and put it on the Post-Treatment Period</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  # Define what is in the Pre- and Post-Treatment Periods</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  # if it is the iteration_day, then we state that it is the the Post-Treatment period but putting it right before the original start and shift all following days in the original Pre-Treatment period &#x27;left&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  new_geo_data$time = sapply(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    new_geo_data$time, function(x) ifelse(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      x == iteration_day, treatment_start_date - 1, </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      ifelse((x &lt; treatment_start_date) &amp; (x &gt; iteration_day), x - 1, x)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      )</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    )</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  # 2) We train another Augmented Synthetic Control Model </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  synthetic_control_model &lt;- train_augmented_synthetic_control(new_geo_data, treatment_start_date - 1)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  # 3) We calculate the absolute difference (abs(e) )between what was observed in D_pre and what the model estimated</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  residuals &lt;- predict(synthetic_control_model, att = F)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  error &lt;- abs(mean(new_geo_data$Y[(new_geo_data$time == (treatment_start_date - 1)) &amp; (new_geo_data$location %in% treated_locations)]) -  residuals[treatment_start_date - 1])</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  # 4) For each day in the original Post-Treatment Period, we collect the difference between what was observed and what the model predicted. From this vector we create 2 others, one where we add abs(e) and one where we subtract abs(e) creating respectively the upper and lower bound for the counterfactual</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  upper_bound &lt;- c(residuals[post_treatment_days], mean(residuals[post_treatment_days]))  +  error</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  lower_bound &lt;- c(residuals[post_treatment_days], mean(residuals[post_treatment_days])) - error</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  # 5) We store these lower and upper bound values   </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  return(list(upper_bound = upper_bound, lower_bound = lower_bound, error = error))</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">augsynth_model &lt;- train_augmented_synthetic_control(GeoTestData_Test, post_period_start)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">obs_values &lt;- (predict(augsynth_model, att = T) + predict(augsynth_model, att = F))[post_period_start:post_period_ends]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">obs_values &lt;- c(obs_values, mean(obs_values))</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">upper_bound = c()</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">lower_bound = c()</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># ... for each day D_pre in the Pre-Treatment Period (we run the previously defined steps)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">for (day in 1:(post_period_start - 1)){</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  result &lt;- jacknife_estimator(GeoTestData_Test, post_period_start, post_period_ends, day)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  upper_bound &lt;- rbind(upper_bound, result$upper_bound)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  lower_bound &lt;- rbind(lower_bound, result$lower_bound)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># 6) The confidence interval is then obtained by getting the respective quantiles from the upper/lower bound</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># using the same parameters as before:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">alpha = (1 - 0.9) # for 90% confidence interval</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># We obtain the confidence intervals for the ATT by subtracting from what was observed (factual) the upper/lower bounds of the counterfactual</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">post_treament_upper_bound &lt;- obs_values - apply(lower_bound, 2, function(x) quantile(x, alpha/2))</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">post_treament_lower_bound &lt;- obs_values - apply(upper_bound, 2, function(x) quantile(x, 1 - alpha/2))</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">print(post_treament_upper_bound)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#&gt;         91         92         93         94         95         96         97 </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#&gt; 331.336571 155.656817 125.461659   4.687216 286.346779 216.483095 567.128420 </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#&gt;         98         99        100        101        102        103        104 </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#&gt; 630.101980 471.727499 479.616984 588.369348 636.523734 505.765583 443.125831 </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#&gt;        105            </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#&gt; 235.131135 378.330998</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">print(post_treament_lower_bound)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#&gt;         91         92         93         94         95         96         97 </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#&gt; -126.25015 -301.95956 -329.52402 -452.65056 -171.83181 -238.57023  113.75990 </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#&gt;         98         99        100        101        102        103        104 </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#&gt;  177.19184   16.16962   16.43517  120.48222  175.10239   48.46091  -11.15596 </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#&gt;        105            </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#&gt; -220.89674  -81.69113</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>The last value on the vectors ‘post_treament_upper_bound’ and
‘post_treament_lower_bound’ refer to the upper and lower bound of the
ATT for the whole Post-Treatment Period. If we multiply them by the
number of locations (2) and the number of days in the Post-Treatment
Period, we obtain the interval provided by GeoLift:</p><div class="codeBlockContainer_K1bP language-r theme-code-block"><div class="codeBlockContent_hGly r"><pre tabindex="0" class="prism-code language-r codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">GeoTest</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#&gt; </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#&gt; GeoLift Output</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#&gt; </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#&gt; Test results for 15 treatment periods, from time-stamp 91 to 105 for test markets:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#&gt; 1 CHICAGO</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#&gt; 2 PORTLAND</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#&gt; ##################################</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#&gt; #####     Test Statistics    #####</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#&gt; ##################################</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#&gt; </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#&gt; Percent Lift: 5.4%</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#&gt; </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#&gt; Incremental Y: 4667</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#&gt; </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#&gt; 90% Confidence Interval: (-2450.734, 11349.93)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#&gt; </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#&gt; Average Estimated Treatment Effect (ATT): 155.556</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#&gt; </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#&gt; The results are significant at a 95% level. (TWO-SIDED LIFT TEST)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#&gt; </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#&gt; There is a 1.2% chance of observing an effect this large or larger assuming treatment effect is zero.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">print(tail(post_treament_upper_bound, 1) * length(treated_locations) * (post_period_ends - post_period_start + 1))</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#&gt;          </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#&gt; 11349.93</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">print(tail(post_treament_lower_bound, 1) * length(treated_locations) * (post_period_ends - post_period_start + 1))</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#&gt;           </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#&gt; -2450.734</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Thus Jackknife+ method provides an estimate of the Confidence Interval
for the ATT that is based on the error that model has on each day of the
Pre-Treatment Period if it was put in the Post-Treatment Period. Because
the days that got moved actually didn’t receive the treatment, the error
that the model has on each one of these days gives some insight on the
accuracy of our model in estimating the counter-factual for the treated
locations during the Post-Treatment Period. Because we remove one day at
a time, the coefficients found for our model aren’t too different to
what we obtain using the whole Pre-Treatment Period data. However,
because we use the absolute value of the error of the model in each one
of the moved dates, the confidence interval estimated by this method
tends to be larger than the true confidence interval of the estimated
treatment effect.</p><header><h1>Frequently Asked Questions</h1></header><p><strong>The estimation of the Confidence Intervals are supposed to be
deterministic from the documentation, but when I run it it varies.</strong></p><p>The estimation of the Confidence Intervals and the p-value using
Conformal Inference is indeed deterministic <em>when using overlapping
moving block permutations</em>. If instead we were to consider all block
permutations (or sample from them) which happens when the parameter
<code>conformal_type</code> is <code>&quot;iid&quot;</code>, then GeoLift extract <code>ns</code> samples from all
the possible block permutations, which means that the estimated
confidence intervals and the p-value can vary slightly</p><p><strong>When I ask GeoLift to provide confidence intervals for the ATT it
raises a warning saying that the Conformal Inference method failed. Why
does this happen?</strong></p><p>This happens because when trying to estimate the p-values for the
different possible lifts, all the p-values estimated were too low. As a
consequence of all p-values being too small, when we execute step (8)
<code>lower_bound &lt;- min(grid[p_values &gt;= alpha])</code>, we can’t find any case
where a p-value was greater than the alpha we require for the confidence
interval (remember that alpha = 1 - confidence interval size). This
happens if one or more conditions for the Conformal Inference method are
not satisfied, with one of the most common being that the observations
on each day are not ‘iid’, which is usually solved by changing the
<code>conformal_type</code> input to <code>&quot;block&quot;</code>.</p><p><strong>There are cases where the ATT for the Post-Treatment Period indicates
for a 90% confidence interval a lower bound below 0, even though the
p-value is low (e.g. 5%). Why does this happen?</strong></p><p>This often happens because either</p><ol><li>You used different <code>conformal_type</code> for the p-value and for the
confidence interval,</li><li>you used Jackknife+ for one of the metrics and Conformal Inference
for the other. This usually happens when Conformal Inference method
fails to estimate the confidence interval and fallbacks to the
Jackknife+, or</li><li>the estimation of the p-value using the Conformal Inference method
is inaccurate for the specific case you are using (see step (7) in
the Conformal Inference explanation above).</li></ol><p>For the last point, you can verify that is the source of the problem by
plotting the estimated p-values for each assumed lift (given by the
variable <code>grid</code> on step (7)). When you <code>plot(grid, p_values)</code>, you
should see a curve resembling a normal distribution. It doesn’t have to
be normal, as it can be asymmetric and long-tailed, but it shouldn’t
deviate much from what a normal distribution looks like. Cases that
don’t look like a normal distribution is when the curve is bi-modal or
the p-value for points close to each other in the <code>grid</code> to are much
different.</p><p><strong>Should I expect the confidence intervals estimated by the Jackknife+
and Conformal Inference to be the same?</strong></p><p>They should be similar, though Jackknife+ should indicate a wider
interval than Conformal Inference. The cause originates in step (4) of
the Jackknife algorithm described above, where we add/subtract the
absolute error <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA0AAAALBAMAAABWnBpSAAAALVBMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAOrOgAAAADnRSTlMAdrvN3WbvMhCZq0RUIgasC6QAAAAJcEhZcwAADsQAAA7EAZUrDhsAAABRSURBVAgdY2BgYFR2EWBgYGBNKuBwBdJxExgYFjIwcD9rYKj0YGBgembsvBQozPYGSAAB31sIzQyieYHangLpbQ0MDGoXGKpsgWxWE5PVDAwAhwYPMLPATEgAAAAASUVORK5CYII="> to estimate the upper/lower bound in one iteration.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/facebookincubator/GeoLift/docs/Methodology/Confidence_Interval_Explanation.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_13-_"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/GeoLift/docs/Methodology/ComparisonOthers"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Comparison to other Methodologies</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/GeoLift/docs/Best Practices/BestPractices"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">GeoLift Best Practices</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#default-conformal-inference-method" class="table-of-contents__link toc-highlight">Default: Conformal Inference Method</a><ul><li><a href="#estimating-the-p-value" class="table-of-contents__link toc-highlight">Estimating the p-value</a></li><li><a href="#estimating-the-confidence-interval" class="table-of-contents__link toc-highlight">Estimating the Confidence Interval</a></li><li><a href="#implementation-of-the-algorithm" class="table-of-contents__link toc-highlight">Implementation of the algorithm</a></li></ul></li><li><a href="#the-backfall-jackknife-method" class="table-of-contents__link toc-highlight">The backfall: Jackknife Method</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Learn</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/GeoLift/docs/intro">Documentation</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://www.facebook.com/groups/fbgeolift" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Facebook<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/GeoLift/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/facebookincubator/GeoLift/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">Legal</div><ul class="footer__items"><li class="footer__item"><a href="https://opensource.facebook.com/legal/privacy/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Privacy<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://opensource.facebook.com/legal/terms/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Terms<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://opensource.facebook.com/legal/data-policy/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Data Policy<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://opensource.facebook.com/legal/cookie-policy/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Cookie Policy<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><a href="https://opensource.facebook.com" target="_blank" rel="noopener noreferrer" class="footerLogoLink_MyFc"><img src="/GeoLift/img/oss_logo.png" alt="Facebook Open Source Logo" class="themedImage_1VuW themedImage--light_3UqQ footer__logo"><img src="/GeoLift/img/oss_logo.png" alt="Facebook Open Source Logo" class="themedImage_1VuW themedImage--dark_hz6m footer__logo"></a></div><div class="footer__copyright">Copyright © 2024 Meta Platforms, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/GeoLift/assets/js/runtime~main.2c495a46.js"></script>
<script src="/GeoLift/assets/js/main.66c3a460.js"></script>
</body>
</html>